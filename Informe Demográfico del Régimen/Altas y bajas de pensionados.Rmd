---
title: "Altas de pensionados"
output: html_document
encoding: UTF-8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE,message=FALSE, echo=FALSE}
library(readxl)
library(tidyr)
library(dplyr)
library(ggplot2)
```

```{r, message = FALSE, echo=FALSE}
# se cargan los datos de interés
pensionados <- read_excel("Fondo C.xlsx", sheet = "Pensionados")
# se eliminan las columnas no necesarias
pensionados <- pensionados[,c(2,4,5,8)]

# Se rellenan datos faltantes para pensionados por vejez

# calcula edad de pension
pensionados <- pensionados %>%
  mutate(Edad_Pension = as.numeric(difftime(`Rige de la Pensión`, FEC_NAC, units = "days")) / 365.25) 

#calcula el promedio de edad de pension por tipo y sexo
promedio_edad_pension_tipo<- pensionados %>%
  group_by(COD_TIPO_PENSION, SEXO) %>%
  summarize(promedio_edad_pension = mean(Edad_Pension, na.rm = TRUE)) 

#aquí trabaja solo con los que tiene NA's
pensionados_na <- pensionados %>%
  filter(is.na(`Rige de la Pensión`)) 

# se le agrega la edad de pensión promedio a los que tienen NA's
pensionados_na_con_promedio <- left_join(pensionados_na, promedio_edad_pension_tipo, by = c("SEXO", "COD_TIPO_PENSION"))

# Actualiza la columna 'Edad_Pension' con el promedio de edad de pensión correspondiente
pensionados_na_con_promedio <- pensionados_na_con_promedio %>%
  mutate(Edad_Pension = ifelse(is.na(Edad_Pension), promedio_edad_pension, Edad_Pension))

# Eliminar la columna 'promedio_edad_pension'
pensionados_na_con_promedio <- pensionados_na_con_promedio[, -6]

# pone la fecha en que se pensionarían
pensionados_na_con_promedio <- pensionados_na_con_promedio %>%
  mutate(`Rige de la Pensión` = FEC_NAC + as.numeric(Edad_Pension) * 365.25 * 24 * 60 * 60)  

# se une todo
pensionados <- bind_rows(pensionados_na_con_promedio, pensionados %>% filter(!is.na(`Rige de la Pensión`))) 

# se extrae  el año de la fecha
pensionados$año <- format(pensionados$`Rige de la Pensión`, "%Y")

# se cuenta la cantidad de pensionados que ingresan por mes, año y tipo de pensión
conteo <- pensionados %>%
  group_by(año, COD_TIPO_PENSION) %>%
  summarise(cantidad_personas = n())
conteo$año <- as.numeric(conteo$año)

```

A continuación, se analizan las altas de los pensionados del Régimen 
en estudio, específicamente, la cantidad de entradas de pensionados 
por año y por tipo de pensión (Invalidez, Vejez y Sucesión), durante un 
periodo que abarca desde el 2001 al 2023. Algunos pensionados no cuentan con la fecha
de inicio del pago de la pensión, por lo que, no se toman en cuenta para el análisis.

En el gráfico 1, se muestra el comportamiento de las entradas de pensionados.

```{r, warning=FALSE, echo=FALSE}
  ggplot(conteo, aes(x = as.numeric(año), y = cantidad_personas, color = COD_TIPO_PENSION)) +
  geom_line() +
  labs(title = " Gráfico 1: Entradas de pensionados por año, del Régimen",
       subtitle = "2001-2023",x = " Año de inicio de pago de la pensión",
       y = "Cantidad de personas pensionadas", color = "Tipo de pensión")+
  scale_color_manual(values = c("#2F4F4F", "cadetblue3", "#BCEE68"))+
  theme_minimal()+
   theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0, color = "black", size = 8),
        legend.title = element_blank()) +
  labs(caption = expression(bold("Fuente: ") * "Elaborado a partir de datos de."))

```

Es posible observar que para el caso de los pensionados por invalidez,
las entradas entre el 2001 y el 2014 son similares, están rondando entre 1 y 3 
personas. Posteriormente, se presenta un incremento a partir del 2015, alcanzando
un pico de 10 nuevos pensionados por invalidez en el 2019. Sin embargo, en los
último años, se experimentó una baja en la cantidad de ingresos siendo en el 2023
de una sola persona.

En cuanto a los nuevos pensionados por sucesión, se presentan registros a partir
del 2004. Se puede identificar una tendencia a la alta con el mayor ingreso
de pensionados por este tipo entre el 2018 y el 2022, experimentando un pico de 20 
pensionados en el 2021. No obstante, al igual que la pensión anterior, se presentó un 
decrecimiento en las entradas ingresando solo una persona en el 2023.

Con respecto a los pensionados por vejez, no se presentó ningún registro de
entrada hasta el 2010. En el periodo del 2010 al 2015, la cantidad de nuevos 
pensionados por vejez estuvo entre 1 y 7 personas. En los años siguientes aumentó
la cantidad de entradas, alcanzando un valor máximo de 46 personas en el 2022. 
Al igual que los otros dos tipos de pensiones, para el 2023 se sufrió una reducción
en los ingresos recibiendo a 21 personas.

En síntesis, se identifica que en el periodo de estudio, el mayor crecimiento de entradas de 
pensionados son percibidos por las pensiones por vejez, seguido de las pensiones
por sucesión y por último, las de invalidez. Las tres mostraron una tendencia a
la alta pero bajaron en el 2023.



